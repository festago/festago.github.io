{"componentChunkName":"component---src-pages-search-jsx","path":"/search/","result":{"data":{"allMarkdownRemark":{"nodes":[{"excerpt":"ì„œë¡  ì•ˆë…•í•˜ì„¸ìš”. í˜ìŠ¤íƒ€ê³ ì˜ ê¸€ë Œì…ë‹ˆë‹¤. ğŸ¥ƒ í˜ìŠ¤íƒ€ê³ ëŠ” ì¸ì¦ì„ êµ¬í˜„í•  ë•Œ, ìµœì†Œí•œì˜ ì •ë³´ë¡œ ì•ˆì „í•˜ê²Œ ì¸ì¦ì„ êµ¬í˜„í•  ìˆ˜ ìˆëŠ” OAuth2ë¥¼ ì±„íƒí•˜ì˜€ìŠµë‹ˆë‹¤. OAuth2ë¥¼ êµ¬í˜„í•  ë•Œ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ëŠ” íšŒì‚¬ë“¤ì€ ë§¤ìš° ë§ìŠµë‹ˆë‹¤. ê·¸ì¤‘ì—ì„œ ì €í¬ê°€ ì„ íƒí•œ OAuth2 ì œê³µìëŠ”  ì…ë‹ˆë‹¤. ì¹´ì¹´ì˜¤í†¡ì„ ì„ íƒí•œ ì´ìœ ëŠ” ì €í¬ ì„œë¹„ìŠ¤ì˜ íŠ¹ì„±ìƒ ì‚¬ìš©ì ê°„ì˜ í‹°ì¼“ ê±°ë˜ë¥¼ ë§‰ê¸° ìœ„â€¦","fields":{"slug":"/oauth2-select-and-apply/"},"frontmatter":{"date":"August 20, 2023","title":"í˜ìŠ¤íƒ€ê³ ì˜ ì¸ì¦ - OAuth2ë¥¼ ì„ íƒí•˜ê³  ì ìš©í•œ ë°©ë²•","tags":["OAuth2"]},"rawMarkdownBody":"\n## ì„œë¡ \n\nì•ˆë…•í•˜ì„¸ìš”.\n\ní˜ìŠ¤íƒ€ê³ ì˜ ê¸€ë Œì…ë‹ˆë‹¤. ğŸ¥ƒ\n\ní˜ìŠ¤íƒ€ê³ ëŠ” ì¸ì¦ì„ êµ¬í˜„í•  ë•Œ, ìµœì†Œí•œì˜ ì •ë³´ë¡œ ì•ˆì „í•˜ê²Œ ì¸ì¦ì„ êµ¬í˜„í•  ìˆ˜ ìˆëŠ” OAuth2ë¥¼ ì±„íƒí•˜ì˜€ìŠµë‹ˆë‹¤.\n\nOAuth2ë¥¼ êµ¬í˜„í•  ë•Œ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ëŠ” íšŒì‚¬ë“¤ì€ ë§¤ìš° ë§ìŠµë‹ˆë‹¤.\n\nê·¸ì¤‘ì—ì„œ ì €í¬ê°€ ì„ íƒí•œ OAuth2 ì œê³µìëŠ” `ì¹´ì¹´ì˜¤í†¡` ì…ë‹ˆë‹¤.\n\nì¹´ì¹´ì˜¤í†¡ì„ ì„ íƒí•œ ì´ìœ ëŠ” ì €í¬ ì„œë¹„ìŠ¤ì˜ íŠ¹ì„±ìƒ ì‚¬ìš©ì ê°„ì˜ í‹°ì¼“ ê±°ë˜ë¥¼ ë§‰ê¸° ìœ„í•¨ì¸ë°ìš”.\n\nêµ¬ê¸€ì´ë‚˜ í˜ì´ìŠ¤ë¶ ë“± ì‰½ê²Œ ê³„ì •ì„ ìƒì„±í•  ìˆ˜ ìˆëŠ” ì„œë¹„ìŠ¤ëŠ” í•œ ëª…ì˜ ì‚¬ìš©ìê°€ ì—¬ëŸ¬ ê³„ì •ì„ í†µí•´ í‹°ì¼“ì„ ì˜ˆë§¤í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, êµ­ë‚´ì—ì„œ ìœ ì¼í•œ ì „í™”ë²ˆí˜¸ë¡œ ê³„ì •ì„ ìƒì„±í•  ìˆ˜ ìˆëŠ” ì„œë¹„ìŠ¤ ì œê³µìì¸ ì¹´ì¹´ì˜¤í†¡ì„ ì„ íƒí•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.\n\ní˜ìŠ¤íƒ€ê³ ì—ì„œ êµ¬í˜„í•œ OAuth2ì˜ ì¸ì¦ í”Œë¡œìš°ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.\n\n![](images/20230819155223.png)\n\nì´ ë°©ì‹ì€ `Authorization Code Grant Type`ë¼ê³  ë¶ˆë¦¬ëŠ” OAuth2 ì¸ì¦ ë°©ì‹ì˜ ì¢…ë¥˜ ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤.\n\ní•´ë‹¹ ì¸ì¦ ë°©ì‹ì€ ì‚¬ìš©ìëŠ” ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” OAuth2 ì¸ì¦ ì„œë²„ë¡œ ìš”ì²­ì„ ë³´ë‚´ê³ , ì¸ì¦ ì„œë²„ëŠ” í´ë¼ì´ì–¸íŠ¸(ë°±ì—”ë“œ ìŠ¤í”„ë§ ì„œë²„)ì— ì—‘ì„¸ìŠ¤ í† í°ê³¼ ì‚¬ìš©ì ì •ë³´ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.\n\nì´ëŸ¬í•œ ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©ìì˜ ì—‘ì„¸ìŠ¤ í† í°ê³¼ ì‚¬ìš©ì ì •ë³´ì˜ ë…¸ì¶œì„ ìµœì†Œí™”í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë³´ì•ˆì˜ ì‹ ë¢°ì„±ì´ ë†’ìŠµë‹ˆë‹¤.\n\nì´ëŸ¬í•œ ë°©ì‹ì„ ì–´ë–»ê²Œ ì½”ë“œë¡œ êµ¬í˜„í•˜ì˜€ëŠ”ì§€ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.\n\nì½”ë“œë¡œ êµ¬í˜„í•  í´ë˜ìŠ¤ë¥¼ ê°„ëµíˆ ë‚˜íƒ€ë‚¸ë‹¤ë©´ í•œë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.\n\n`SocialType`: Enumìœ¼ë¡œ OAuth2ì˜ ì œê³µìë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. (ex: KAKAO)\n\n`AuthProvider`: ì‚¬ìš©ì ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì €í¬ì˜ ì—‘ì„¸ìŠ¤ í† í°ì„ ë§Œë“¤ì–´ ì£¼ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.\n\n`AuthExtractor`: ì—‘ì„¸ìŠ¤ í† í°ì„ íŒŒì‹±í•˜ì—¬ ìœ íš¨ì„±ì„ ê²€ì¦í•˜ê³  Payloadì˜ ê°’ì„ ì¶”ì¶œí•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.\n\n`OAuth2Client`: OAuth2 ì¸ì¦, ë¦¬ì†ŒìŠ¤ ì„œë²„ë¡œ ìš”ì²­ì„ ë³´ë‚´ê³  ì—‘ì„¸ìŠ¤ í† í°, ì‚¬ìš©ì ì •ë³´ ë“± ë¯¼ê°í•œ ì •ë³´ë¥¼ ë°›ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.\n\n`Member`: ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ ë‹´ê³  ìˆëŠ” ì—”í‹°í‹°ë¡œ, `SocialType`ì„ í•„ë“œë¡œ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.\n\n`AuthService`: ì¸ì¦ì„ ìˆ˜í–‰í•˜ëŠ” ì„œë¹„ìŠ¤ ë ˆì´ì–´ í´ë˜ìŠ¤ì…ë‹ˆë‹¤.\n\nì—¬ê¸°ì„œ `OAuth2Client`ëŠ” ì™¸ë¶€ APIì— ì˜ì¡´í•˜ë¯€ë¡œ, ì¸í„°í˜ì´ìŠ¤ë¡œ ë§Œë“¤ì–´ í…ŒìŠ¤íŠ¸ë‚˜ ë¡œì»¬ í™˜ê²½ì—ì„œ ëª¨ì˜ ê°ì²´ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.\n#### AuthProvider\n```java\npublic class JwtAuthProvider implements AuthProvider {  \n  \n    private static final int SECOND_FACTOR = 60;  \n    private static final int MILLISECOND_FACTOR = 1000;  \n    private static final String MEMBER_ID_KEY = \"memberId\";\n  \n    private final SecretKey key;  \n    private final long expirationMinutes;  \n  \n    public JwtAuthProvider(String secretKey, long expirationMinutes) {  \n        this.key = Keys.hmacShaKeyFor(secretKey.getBytes(StandardCharsets.UTF_8));  \n        this.expirationMinutes = expirationMinutes;  \n    }  \n  \n    @Override  \n    public String provide(AuthPayload authPayload) {  \n        Date now = new Date();  \n        return Jwts.builder()  \n            .claim(MEMBER_ID_KEY, authPayload.getMemberId())   \n            .setIssuedAt(now)  \n            .setExpiration(new Date(now.getTime() + expirationMinutes * SECOND_FACTOR * MILLISECOND_FACTOR))  \n            .signWith(key, SignatureAlgorithm.HS256)  \n            .compact();  \n    }  \n}\n```\n\nAuthProviderì˜ êµ¬í˜„ì²´ì¸ `JwtAuthProvider` ì…ë‹ˆë‹¤.\n\n`Member` ì—”í‹°í‹°ì˜ PKë¥¼ Payloadì— ë„£ì–´ JWT í† í°ì„ ë°˜í™˜í•´ ì¤ë‹ˆë‹¤.\n\ní•´ë‹¹ í† í°ì€ ì•ìœ¼ë¡œ ì €í¬ ì„œë²„ì— ì¸ì¦ ê³¼ì •ì— í•„ìš”í•œ ì—‘ì„¸ìŠ¤ í† í°ì…ë‹ˆë‹¤.\n\n#### AuthExtractor\n```java\npublic class JwtAuthExtractor implements AuthExtractor {  \n  \n    private static final String MEMBER_ID_KEY = \"memberId\";  \n  \n    private final JwtParser jwtParser;  \n  \n    public JwtAuthExtractor(String secretKey) {  \n        SecretKey key = Keys.hmacShaKeyFor(secretKey.getBytes(StandardCharsets.UTF_8));  \n        this.jwtParser = Jwts.parserBuilder()  \n            .setSigningKey(key)  \n            .build();  \n    }  \n  \n    @Override  \n    public AuthPayload extract(String token) {  \n        Claims claims = getClaims(token);  \n        Long memberId = claims.get(MEMBER_ID_KEY, Long.class);  \n        return new AuthPayload(memberId);  \n    }  \n  \n    private Claims getClaims(String code) {  \n        try {  \n            return jwtParser.parseClaimsJws(code)  \n                .getBody();  \n        } catch (ExpiredJwtException e) {  \n            throw new UnauthorizedException(ErrorCode.EXPIRED_AUTH_TOKEN);  \n        } catch (JwtException | IllegalArgumentException e) {  \n            throw new UnauthorizedException(ErrorCode.INVALID_AUTH_TOKEN);  \n        }  \n    }  \n}\n```\n\nAuthExtractorì˜ êµ¬í˜„ì²´ì¸ `JwtAuthExtractor` ì…ë‹ˆë‹¤.\n\ní† í°ì„ ë°›ì•„ `AuthPayload` ê°ì²´ë¡œ ë§Œë“¤ì–´ ë°˜í™˜í•©ë‹ˆë‹¤.\n\nì°¸ê³ ë¡œ í•„ë“œë¡œ `JwtParser`ë¥¼ ê°€ì§€ê³  ìˆëŠ”ë° ì´ëŠ” `Jwts.parserBuilder()` ë©”ì†Œë“œë¡œ ìƒì„±ëœ ì¸ìŠ¤í„´ìŠ¤ëŠ” ë¶ˆë³€í•˜ê³ , thread-safe í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.\n\n![](images/20230818023037.png)\n\në”°ë¼ì„œ ë‹¤ìŒê³¼ ê°™ì´ íŒŒì‹±í•  ë•Œë§ˆë‹¤ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒˆë¡­ê²Œ ë§Œë“¤ì§€ ì•Šê³ , ê¸°ì¡´ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n```java\n// íŒŒì‹±ë§ˆë‹¤ ìƒˆë¡œìš´ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±\nreturn Jwts.parserBuilder()  \n            .setSigningKey(key)  \n            .build()\n            .parseClaimsJws(code)  \n            .getBody();\n\n// íŒŒì‹±ë§ˆë‹¤ ê¸°ì¡´ì˜ ì¸ìŠ¤í„´ìŠ¤ ì¬ì‚¬ìš©\nreturn jwtParser.parseClaimsJws(code)  \n                .getBody();  \n```\n\n#### OAuth2Client\n```java\n@Component\npublic class KakaoOAuth2Client implements OAuth2Client {  \n  \n    private static final String ACCESS_TOKEN_URL = \"https://kauth.kakao.com/oauth/token\";  \n    private static final String USER_INFO_URL = \"https://kapi.kakao.com/v2/user/me\";  \n  \n    private final RestTemplate restTemplate;  \n    private final String grantType;  \n    private final String clientId;  \n    private final String redirectId;  \n  \n    public KakaoOAuth2Client(  \n        @Value(\"${festago.oauth2.kakao.grant-type}\") String grantType,  \n        @Value(\"${festago.oauth2.kakao.client-id}\") String clientId,  \n        @Value(\"${festago.oauth2.kakao.redirect-uri}\") String redirectUri,  \n        RestTemplateBuilder restTemplateBuilder  \n    ) {  \n        this.grantType = grantType;  \n        this.clientId = clientId;  \n        this.redirectId = redirectUri;  \n        this.restTemplate = restTemplateBuilder.build();  \n    }  \n  \n    public String getAccessToken(String code) {  \n        HttpHeaders headers = new HttpHeaders();  \n        headers.setContentType(MediaType.APPLICATION_FORM_URLENCODED);  \n        headers.add(\"grant_type\", grantType);  \n        headers.add(\"client_id\", clientId);  \n        headers.add(\"redirect_uri\", redirectId);  \n        headers.add(\"code\", code);  \n  \n        try {  \n            KakaoAccessTokenResponse response = restTemplate.postForEntity(  \n                ACCESS_TOKEN_URL, headers,  \n                KakaoAccessTokenResponse.class).getBody();  \n            return response.accessToken();  \n        } catch (HttpClientErrorException e) {  \n            KakaoOAuth2Error kakaoOAuth2Error = e.getResponseBodyAs(KakaoOAuth2Error.class);  \n            if (kakaoOAuth2Error.isErrorCodeKOE320()) {  \n                throw new BadRequestException(ErrorCode.OAUTH2_INVALID_CODE);  \n            }  \n            throw new InternalServerException(ErrorCode.INTERNAL_SERVER_ERROR, e);  \n        }  \n    }  \n  \n    public UserInfo getUserInfo(String accessToken) {  \n        HttpHeaders headers = new HttpHeaders();  \n        headers.setContentType(MediaType.APPLICATION_FORM_URLENCODED);  \n        headers.setBearerAuth(accessToken);  \n  \n        try {  \n            KakaoUserInfo kakaoUserInfo = restTemplate.postForEntity(USER_INFO_URL, new HttpEntity<>(headers),  \n                    KakaoUserInfo.class)  \n                .getBody();  \n            return UserInfo.ofKakao(kakaoUserInfo);  \n        } catch (HttpClientErrorException e) {  \n            throw new InternalServerException(ErrorCode.INTERNAL_SERVER_ERROR, e);  \n        }  \n    }  \n  \n    public record KakaoOAuth2Error(  \n        String error,  \n        @JsonProperty(\"error_description\") String errorDescription,  \n        @JsonProperty(\"error_code\") String errorCode  \n    ) {  \n  \n        public boolean isErrorCodeKOE320() {  \n            return errorCode.equals(\"KOE320\");  \n        }  \n    }  \n}\n```\n\nì‹¤ì œ ì¹´ì¹´ì˜¤ OAuth2 ì„œë¹„ìŠ¤ ì œê³µìì—ê²Œ ì •ë³´ë¥¼ ìš”ì²­í•˜ëŠ” `KakaoOAuth2Client` ì…ë‹ˆë‹¤.\n\nì½”ë“œì— ì§€ì €ë¶„í•œ ê³³ì´ ë§ê³ , ë‹¨ì¼ ì±…ì„ ì›ì¹™ì„ ì§€í‚¤ì§€ ì•ŠëŠ” ë¶€ë¶„ì´ ìˆìŠµë‹ˆë‹¤. (ì•¡ì„¸ìŠ¤ í† í° ìš”ì²­, ì‚¬ìš©ì ì •ë³´ ìš”ì²­)\n\nì¶”í›„ ì´ ë¶€ë¶„ì„ ì–´ë–»ê²Œ ê°œì„ í–ˆëŠ”ì§€ ì•Œë ¤ë“œë¦¬ê² ìŠµë‹ˆë‹¤.\n\n> recordì— @JsonPropertyë¥¼ ì‚¬ìš©í•œ ì´ìœ ëŠ” [ìŠ¤íƒ ì˜¤ë²„í”Œë¡œìš° ë§í¬](https://stackoverflow.com/questions/68394911/why-record-class-cant-be-properly-deserialized-with-jackson)ì— ë‚˜ì™€ ìˆìŠµë‹ˆë‹¤.\n\n#### AuthService\n```java\n@Service\n@Transactional\npublic class AuthService {  \n  \n    private final MemberRepository memberRepository;  \n    private final OAuth2Client oAuth2Client;  \n    private final AuthProvider authProvider;  \n  \n    public AuthService(MemberRepository memberRepository, OAuth2Client oAuth2Client, AuthProvider authProvider) {  \n        this.memberRepository = memberRepository;  \n        this.oAuth2Client = oAuth2Client;  \n        this.authProvider = authProvider;  \n    }  \n  \n    public LoginResponse login(String code) {  \n        String accessToken = oAuth2Client.getAccessToken(code);  \n        UserInfo userInfo = oAuth2Client.getUserInfo(accessToken);  \n        Member member = memberRepository.findBySocialIdAndSocialType(userInfo.socialId(), userInfo.socialType())  \n            .orElseGet(() -> memberRepository.save(userInfo.toMember()));  \n        return new LoginResponse(authProvider.provide(member), userInfo.nickname());  \n    }  \n}\n```\n\nì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë³´ë‚´ì˜¨ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ì„œë¹„ìŠ¤ í´ë˜ìŠ¤ì…ë‹ˆë‹¤.\n\níë¦„ì€ ë§¨ ìœ„ì—ì„œ ì„¤ëª…í•œ ê²ƒê³¼ ê°™ì´ ì½”ë“œë¥¼ ë°›ì•„, OAuth2 ì„œë¹„ìŠ¤ ì œê³µìë¡œë¶€í„° ì•¡ì„¸ìŠ¤ í† í°ì„ ì–»ê³ , ì‚¬ìš©ì ì •ë³´ë¥¼ ì–»ì€ ë’¤ ê¸°ì¡´ì˜ íšŒì›ì´ ìˆìœ¼ë©´ `AuthProvider`ë¥¼ í†µí•´ ì•¡ì„¸ìŠ¤ í† í°ì„ ë°˜í™˜í•˜ê³ , ê¸°ì¡´ì˜ íšŒì›ì´ ì—†ë‹¤ë©´ `orElseGet()` ë©”ì„œë“œë¥¼ í†µí•´ íšŒì›ì„ ìƒì„±í•˜ê³  ì•¡ì„¸ìŠ¤ í† í°ì„ ë°˜í™˜í•©ë‹ˆë‹¤.\n\n---\n\nì´ë ‡ê²Œ êµ¬í˜„í•œ ë°©ì‹ì—ëŠ” ë¬¸ì œì ì´ ìˆìŠµë‹ˆë‹¤.\n\n`OAuth2Client`ì˜ ì½”ë“œë¥¼ ë³´ë©´ ë‹¨ì¼ ì±…ì„ ì›ì¹™ì„ ì§€í‚¤ì§€ ëª»í–ˆê³ (ì•¡ì„¸ìŠ¤ ì½”ë“œì™€ ì‚¬ìš©ì ì •ë³´ë¥¼ ëª¨ë‘ ê´€ë¦¬) ìš”ì²­ì„ ë³´ë‚¼ ë•Œ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ try-catchë¬¸ ë•Œë¬¸ì— ì½”ë“œì˜ ê°€ë…ì„±ì´ ë‚˜ì©ë‹ˆë‹¤.\n\nê·¸ë¦¬ê³  `OAuth2Client`ë¥¼ ì¸í„°í˜ì´ìŠ¤ë¡œ ì •ì˜í•˜ì—¬ ë³€ê²½ì—ëŠ” ìœ ì—°í•˜ê²Œ ëŒ€ì‘í–ˆì§€ë§Œ, ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ì´ê¸° ë•Œë¬¸ì— ë‹¤ë¥¸ OAuth2 ì„œë¹„ìŠ¤ ì œê³µìê°€ ì¶”ê°€ë  ê²½ìš° ìƒˆë¡œìš´ í´ë˜ìŠ¤ í˜¹ì€ ë©”ì†Œë“œê°€ í•„ìš”í•©ë‹ˆë‹¤.\n\n### ë‹¨ì¼ ì±…ì„ ì›ì¹™ì˜ ë¶„ë¦¬\n\nìœ ëª…í•œ ê°ì²´ ì§€í–¥ ì›ì¹™ì¸ SOLID ì›ì¹™ì—ì„œ SëŠ” ë‹¨ì¼ ì±…ì„ ì›ì¹™ì„ ëœ»í•©ë‹ˆë‹¤.\n\nìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ë¥¼ ì‚¬ìš©í•˜ë©°, ì˜ì¡´ì„± ì£¼ì…ì„ í†µí•œ OCP, DIP ì›ì¹™ì€ ë§¤ìš° ì‰½ê²Œ ì§€í‚¬ ìˆ˜ ìˆìœ¼ë‚˜, SRP ì›ì¹™ì€ êµ¬í˜„í•˜ëŠ” ê°œë°œìê°€ ê°ì²´ê°€ ê°€ì§€ëŠ” ì±…ì„ì„ ì–¼ë§ˆë‚˜ ì˜ êµ¬ë¶„í•  ìˆ˜ ìˆëŠ”ì§€ì— ë”°ë¼ ë‹¬ë ¸ìŠµë‹ˆë‹¤.\n\nOAuth2ClientëŠ” ë‘ ê°€ì§€ ì¼ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.\n1. ì•¡ì„¸ìŠ¤ í† í°ì„ ìš”ì²­\n2. ì‚¬ìš©ì ì •ë³´ë¥¼ ìš”ì²­\n\në‘ ê°€ì§€ ì¼ì€ OAuth2 ì¸ì¦ì˜ íë¦„ìœ¼ë¡œëŠ” í•˜ë‚˜ì˜ ì‘ì—…ìœ¼ë¡œ ë³¼ ìˆ˜ ìˆê² ì§€ë§Œ ê°ì²´ê°€ ê°€ì§€ëŠ” ì±…ì„ì€ ë‘ ê°€ì§€ ì±…ì„ì„ ì§€ê³  ìˆìŠµë‹ˆë‹¤.\n\në”°ë¼ì„œ, ì—‘ì„¸ìŠ¤ í† í°ë§Œ ìš”ì²­í•˜ëŠ” í´ë˜ìŠ¤ì™€ ì‚¬ìš©ì ì •ë³´ë§Œ ìš”ì²­í•˜ëŠ” í´ë˜ìŠ¤ë¡œ ë‚˜ëˆ  ì„¤ê³„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n#### KakaoOAuth2AccessTokenClient\n```java\n@Component\npublic class KakaoOAuth2AccessTokenClient {  \n  \n    private static final String URL = \"https://kauth.kakao.com/oauth/token\";  \n  \n    private final RestTemplate restTemplate;  \n    private final String grantType;  \n    private final String clientId;  \n    private final String redirectUri;  \n  \n    public KakaoOAuth2AccessTokenClient(  \n        @Value(\"${festago.oauth2.kakao.grant-type}\") String grantType,  \n        @Value(\"${festago.oauth2.kakao.client-id}\") String clientId,  \n        @Value(\"${festago.oauth2.kakao.redirect-uri}\") String redirectUri,\n        @Value(\"${festago.oauth2.kakao.client-secret}\") String clientSecret,  \n        RestTemplateBuilder restTemplateBuilder  \n    ) {  \n        this.grantType = grantType;  \n        this.clientId = clientId;  \n        this.redirectUri = redirectUri;  \n        this.clientSecret = clientSecret;\n        this.restTemplate = restTemplateBuilder.build();  \n    }  \n  \n    public String getAccessToken(String code) {  \n        HttpHeaders headers = getAccessTokenHeaders(code);  \n        return requestAccessToken(headers);  \n    }  \n  \n    private HttpHeaders getAccessTokenHeaders(String code) {  \n        HttpHeaders headers = new HttpHeaders();  \n        headers.setContentType(MediaType.APPLICATION_FORM_URLENCODED);  \n        headers.set(\"grant_type\", grantType);  \n        headers.set(\"client_id\", clientId);  \n        headers.set(\"redirect_uri\", redirectUri);  \n        headers.set(\"client_secret\", clientSecret);\n        headers.set(\"code\", code);  \n        return headers;  \n    }  \n  \n    private String requestAccessToken(HttpHeaders headers) {  \n        try {  \n            KakaoAccessTokenResponse response = restTemplate.postForEntity(ACCESS_TOKEN_URL, headers,  \n                KakaoAccessTokenResponse.class).getBody();  \n            return response.accessToken();  \n        } catch (HttpClientErrorException e) {  \n            KakaoOAuth2Error kakaoOAuth2Error = e.getResponseBodyAs(KakaoOAuth2Error.class);  \n            if (kakaoOAuth2Error.isErrorCodeKOE320()) {  \n                throw new BadRequestException(ErrorCode.OAUTH2_INVALID_CODE);  \n            }  \n            throw new InternalServerException(ErrorCode.INTERNAL_SERVER_ERROR, e);  \n        }  \n    }\n}\n```\n\n#### KakaoOAuth2UserInfoClient\n```java\n@Component\npublic class KakaoOAuth2UserInfoClient {  \n  \n    private static final String URL = \"https://kapi.kakao.com/v2/user/me\";  \n  \n    private final RestTemplate restTemplate;  \n  \n    public KakaoOAuth2UserInfoClient(RestTemplateBuilder restTemplateBuilder) {  \n        this.restTemplate = restTemplateBuilder.build();  \n    }  \n  \n    public UserInfo getUserInfo(String accessToken) {  \n        HttpHeaders headers = getUserInfoHeaders(accessToken);  \n        return requestUserInfo(headers);  \n    }  \n  \n    private HttpHeaders getUserInfoHeaders(String accessToken) {  \n        HttpHeaders headers = new HttpHeaders();  \n        headers.setContentType(MediaType.APPLICATION_FORM_URLENCODED);  \n        headers.setBearerAuth(accessToken);  \n        return headers;  \n    }  \n  \n    private UserInfo requestUserInfo(HttpHeaders headers) {  \n        try {  \n            KakaoUserInfo kakaoUserInfo = restTemplate.postForEntity(USER_INFO_URL, new HttpEntity<>(headers),  \n                    KakaoUserInfo.class)  \n                .getBody();  \n            return kakaoUserInfo.toUserInfo();  \n        } catch (HttpClientErrorException e) {  \n            throw new InternalServerException(ErrorCode.INTERNAL_SERVER_ERROR, e);  \n        }\n    }\n}\n```\n\nê·¸ë¦¬ê³  ê¸°ì¡´ì˜ `KakaoOAuth2Client`ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì½”ë“œë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n```java\n@Component  \npublic class KakaoOAuth2Client implements OAuth2Client {\n\n    private final KakaoOAuth2AccessTokenClient accessTokenClient;  \n    private final KakaoOAuth2UserInfoClient userInfoClient;\n    \n    public KakaoOAuth2Client(KakaoOAuth2AccessTokenClient accessTokenClient, KakaoOAuth2UserInfoClient userInfoClient) {  \n        this.accessTokenClient = accessTokenClient;  \n        this.userInfoClient = userInfoClient;  \n    }\n\n    public String getAccessToken(String code) {  \n        return accessTokenClient.getAccessToken(code)\n    }  \n  \n    public UserInfo getUserInfo(String accessToken) {  \n        return userInfoClient.getUserInfo(accessToken);\n    }  \n}\n```\n\nì´ì œë¶€í„° `KakaoOAuth2Client` í´ë˜ìŠ¤ëŠ” ì±…ì„ì„ ë¶„ë¦¬í•œ í´ë˜ìŠ¤ì— ìš”ì²­ì„ ìœ„ì„í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.\n\n#### ResponseErrorHandler\n\ní•˜ì§€ë§Œ ì•„ì§ë„ ì—¬ì „íˆ ì¶”í•œ try-catchê°€ ì½”ë“œì— ë‚¨ì•„ìˆìŠµë‹ˆë‹¤.\n\n`RestTemplate` í´ë˜ìŠ¤ì—ì„œ ë°œìƒí•œ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ì–´ì©” ìˆ˜ ì—†ì´ try-catchë¬¸ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.\n\nê·¸ëŸ°ë° ì—¬ê¸°ì„œ ì ê¹,\n\nì €í¬ëŠ” ìŠ¤í”„ë§ì„ ì‚¬ìš©í•˜ë©° ì»¨íŠ¸ë¡¤ëŸ¬, ì„œë¹„ìŠ¤ ë ˆì´ì–´ì— try-catchë¥¼ ì˜ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\n\nì˜¤íˆë ¤ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•˜ì§€ ì•Šê³  ë˜ì ¸ë²„ë¦½ë‹ˆë‹¤.\n\nê·¸ëŸ¬ëŠ” ì´ìœ ëŠ” ìš”ì²­ì˜ ì˜ˆì™¸ë¥¼ ì „ì—­ì ìœ¼ë¡œ ì²˜ë¦¬í•´ ì£¼ëŠ” `@ControllerAdvice`ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.\n\n`RestTemplate` í´ë˜ìŠ¤ì—ì„œë„ `@ControllerAdvice` ê°™ì€ ì—­í• ì„ í•  ìˆ˜ ìˆëŠ” í´ë˜ìŠ¤ê°€ ìˆìŠµë‹ˆë‹¤.\n\në°”ë¡œ `ResponseErrorHandler` ì…ë‹ˆë‹¤.\n\n`ResponseErrorHandler`ëŠ” ì¸í„°í˜ì´ìŠ¤ë¡œ ë‹¤ìŒê³¼ ê°™ì€ ë‘ ê°œì˜ ì¶”ìƒ ë©”ì†Œë“œë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.\n\n```java\npublic interface ResponseErrorHandler {\n\n    boolean hasError(ClientHttpResponse response) throws IOException;\n    \n    void handleError(ClientHttpResponse response) throws IOException;\n}\n```\n\nì‚¬ì‹¤ ì´ë¯¸ `RestTemplate`ì—ì„œëŠ” ê¸°ë³¸ì ì¸ `ResponseErrorHandler`ê°€ ë“±ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤.\n\n```java\npublic class RestTemplate extends InterceptingHttpAccessor implements RestOperations {\n    ...\n    private ResponseErrorHandler errorHandler = new DefaultResponseErrorHandler();\n    ...\n}\n```\n\në”°ë¼ì„œ ê¸°ì¡´ì˜ `ResponseErrorHandler`ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  ì»¤ìŠ¤í…€í•œ ì—ëŸ¬ í•¸ë“¤ëŸ¬ë¥¼ ë§Œë“¤ì–´ ì‚¬ìš©í•˜ë©´ ì˜ˆì™¸ ì²˜ë¦¬ì— ê´€í•œ ë¡œì§ì„ ë¶„ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n#### KakaoOAuth2AccessTokenErrorHandler\n```java\npublic class KakaoOAuth2AccessTokenErrorHandler extends DefaultResponseErrorHandler {  \n  \n    @Override  \n    public void handleError(ClientHttpResponse response) throws IOException {  \n        try {  \n            super.handleError(response);  \n        } catch (HttpStatusCodeException e) {  \n            HttpStatusCode statusCode = response.getStatusCode();  \n            handle4xxError(statusCode, e);  \n            handle5xxError(statusCode);  \n        }  \n        throw new InternalServerException(ErrorCode.INTERNAL_SERVER_ERROR);  \n    }  \n  \n    private void handle4xxError(HttpStatusCode statusCode, HttpStatusCodeException e) {  \n        if (statusCode.is4xxClientError()) {  \n            KakaoOAuth2ErrorResponse errorResponse = e.getResponseBodyAs(KakaoOAuth2ErrorResponse.class);  \n            handleErrorCode(errorResponse);  \n        }  \n    }  \n  \n    private void handleErrorCode(KakaoOAuth2ErrorResponse errorResponse) {  \n        handleKOE320Error(errorResponse);  \n        throw new InternalServerException(ErrorCode.OAUTH2_INVALID_REQUEST);  \n    }  \n  \n    private void handleKOE320Error(KakaoOAuth2ErrorResponse errorResponse) {  \n        if (errorResponse != null && errorResponse.isErrorCodeKOE320()) {  \n            throw new BadRequestException(ErrorCode.OAUTH2_INVALID_CODE);  \n        }  \n    }  \n  \n    private void handle5xxError(HttpStatusCode statusCode) {  \n        if (statusCode.is5xxServerError()) {  \n            throw new InternalServerException(ErrorCode.OAUTH2_PROVIDER_NOT_RESPONSE);  \n        }  \n    }  \n  \n    public record KakaoOAuth2ErrorResponse(  \n        String error,  \n        @JsonProperty(\"error_description\") String errorDescription,  \n        @JsonProperty(\"error_code\") String errorCode  \n    ) {  \n  \n        public boolean isErrorCodeKOE320() {  \n            return Objects.equals(errorCode, \"KOE320\");  \n        }  \n    }  \n}\n```\n\n#### KakaoOAuth2UserInfoErrorHandler\n```java\npublic class KakaoOAuth2UserInfoErrorHandler extends DefaultResponseErrorHandler {  \n  \n    @Override  \n    public void handleError(ClientHttpResponse response) throws IOException {  \n        HttpStatusCode statusCode = response.getStatusCode();  \n        handle4xxError(statusCode);  \n        handle5xxError(statusCode);  \n        throw new InternalServerException(ErrorCode.INTERNAL_SERVER_ERROR);  \n    }  \n  \n    private void handle4xxError(HttpStatusCode statusCode) {  \n        if (statusCode.is4xxClientError()) {  \n            throw new InternalServerException(ErrorCode.OAUTH2_INVALID_REQUEST);  \n        }  \n    }  \n  \n    private void handle5xxError(HttpStatusCode statusCode) {  \n        if (statusCode.is5xxServerError()) {  \n            throw new InternalServerException(ErrorCode.OAUTH2_PROVIDER_NOT_RESPONSE);  \n        }  \n    }  \n}\n```\n\ní•´ë‹¹ ì—ëŸ¬ í•¸ë“¤ëŸ¬ë¥¼ ì ìš©í•œ OAuth2ClientëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì½”ë“œê°€ ë³€ê²½ë©ë‹ˆë‹¤.\n#### KakaoOAuth2AccessTokenClient\n```java\n@Component\npublic class KakaoOAuth2AccessTokenClient {  \n  \n    private static final String URL = \"https://kauth.kakao.com/oauth/token\";  \n  \n    private final RestTemplate restTemplate;  \n    private final String grantType;  \n    private final String clientId;  \n    private final String redirectUri;  \n  \n    public KakaoOAuth2AccessTokenClient(  \n        @Value(\"${festago.oauth2.kakao.grant-type}\") String grantType,  \n        @Value(\"${festago.oauth2.kakao.client-id}\") String clientId,  \n        @Value(\"${festago.oauth2.kakao.redirect-uri}\") String redirectUri,\n        @Value(\"${festago.oauth2.kakao.client-secret}\") String clientSecret,  \n        RestTemplateBuilder restTemplateBuilder  \n    ) {  \n        this.grantType = grantType;  \n        this.clientId = clientId;  \n        this.redirectUri = redirectUri;  \n        this.clientSecret = clientSecret;\n        this.restTemplate = restTemplateBuilder\n            .errorHandler(new KakaoOAuth2AccessTokenErrorHandler())\n            .build();  \n    }  \n  \n    public String getAccessToken(String code) {  \n        HttpHeaders headers = getAccessTokenHeaders(code);  \n        return requestAccessToken(headers);  \n    }  \n  \n    private HttpHeaders getAccessTokenHeaders(String code) {  \n        HttpHeaders headers = new HttpHeaders();  \n        headers.setContentType(MediaType.APPLICATION_FORM_URLENCODED);  \n        headers.set(\"grant_type\", grantType);  \n        headers.set(\"client_id\", clientId);  \n        headers.set(\"redirect_uri\", redirectUri);  \n        headers.set(\"client_secret\", clientSecret);\n        headers.set(\"code\", code);  \n        return headers;  \n    }  \n  \n    private String requestAccessToken(HttpHeaders headers) {  \n        KakaoAccessTokenResponse response = restTemplate.postForEntity(ACCESS_TOKEN_URL, headers,  \n            KakaoAccessTokenResponse.class).getBody();  \n        return response.accessToken();  \n    }\n}\n```\n\n#### KakaoOAuth2UserInfoClient\n```java\n@Component\npublic class KakaoOAuth2UserInfoClient {  \n  \n    private static final String URL = \"https://kapi.kakao.com/v2/user/me\";  \n  \n    private final RestTemplate restTemplate;  \n  \n    public KakaoOAuth2UserInfoClient(RestTemplateBuilder restTemplateBuilder) {  \n        this.restTemplate = restTemplateBuilder\n            .errorHandler(new KakaoOAuth2UserInfoErrorHandler())\n            .build();  \n    }  \n  \n    public UserInfo getUserInfo(String accessToken) {  \n        HttpHeaders headers = getUserInfoHeaders(accessToken);  \n        return requestUserInfo(headers);  \n    }  \n  \n    private HttpHeaders getUserInfoHeaders(String accessToken) {  \n        HttpHeaders headers = new HttpHeaders();  \n        headers.setContentType(MediaType.APPLICATION_FORM_URLENCODED);  \n        headers.setBearerAuth(accessToken);  \n        return headers;  \n    }  \n  \n    private UserInfo requestUserInfo(HttpHeaders headers) {  \n        KakaoUserInfo kakaoUserInfo = restTemplate.postForEntity(USER_INFO_URL, new HttpEntity<>(headers),  \n                KakaoUserInfo.class)  \n            .getBody();  \n        return kakaoUserInfo.toUserInfo();  \n    }\n}\n```\n\nì´ì²˜ëŸ¼ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•˜ëŠ” ì±…ì„ì„ ê°€ì§„ ê°ì²´ë¡œ ë¶„ë¦¬í•˜ì—¬, ìš”ì²­ì„ ë³´ë‚´ëŠ” ê°ì²´ì—ëŠ” ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•˜ëŠ” ì½”ë“œ í•˜ë‚˜ ì—†ì´ ì˜¤ë¡œì§€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ë§Œ ë‚¨ê²Œ ëœ ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n### ìƒˆë¡œìš´ OAuth2 í´ë¼ì´ì–¸íŠ¸ì˜ ì¶”ê°€\n\nì„œë¹„ìŠ¤ì—ì„œ ì‚¬ìš©í•˜ëŠ” `OAuth2Client`ëŠ” ì¸í„°í˜ì´ìŠ¤ì…ë‹ˆë‹¤.\n\nì¸í„°í˜ì´ìŠ¤ë¡œ ì„¤ê³„í•˜ì—¬, OAuth2 ì„œë¹„ìŠ¤ ì œê³µìê°€ ë°”ë€Œë”ë¼ë„ ì‰½ê²Œ êµì²´í•  ìˆ˜ ìˆê³ , ëª¨ì˜ OAuth2Client ê°ì²´ë¥¼ ë§Œë“¤ì–´ì„œ í…ŒìŠ¤íŠ¸í•  ë•Œ ì™¸ë¶€ APIì˜ ì—°ë™ ì—†ì´ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\ní•˜ì§€ë§Œ ì´ë ‡ê²Œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ë§Œë“¤ì–´ë„, ì¸ìŠ¤í„´ìŠ¤ì˜ í•„ë“œê°€ í•˜ë‚˜ì´ê¸° ë•Œë¬¸ì— ì¶”ê°€ì ì¸ OAuth2Clientë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ì„œë¹„ìŠ¤ ì œê³µìë§ˆë‹¤ ì„œë¹„ìŠ¤ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ê±°ë‚˜, í•„ë“œì™€ ë©”ì†Œë“œê°€ ìƒê¸¸ ê²ƒì…ë‹ˆë‹¤.\n\n```java\npublic class KakaoOAuth2Service{\n    ...\n};\n\npublic class NaverOAuth2Service{\n    ...\n};\n\n// ë˜ëŠ”\n\npublic class AuthService {\n\n    private final OAuth2Client kakaoOAuth2Client;\n    private final OAuth2Client naverOAuth2Client;\n    \n    public void loginKakaoOAuth2(String code) {\n        ...\n    }\n    public void loginKakaoOAuth2(String code) {\n        ...\n    }\n}\n```\n\nì´ê²ƒì€ ë‹¨ì¼ ì±…ì„ ì›ì¹™ì„ ì§€ì¼°ë‹¤ê³  í•  ìˆ˜ ìˆê² ì§€ë§Œ, ì¤‘ë³µëœ ì½”ë“œê°€ ìƒê¸°ê²Œ ë˜ê³  ìƒˆë¡œìš´ ì„œë¹„ìŠ¤ ì œê³µìê°€ ìƒê¸¸ ë•Œ ìƒˆë¡œìš´ ë©”ì†Œë“œë¥¼ ì¶”ê°€í•´ ì¤˜ì•¼ í•©ë‹ˆë‹¤.\n\nê·¸ë ‡ë‹¤ë©´ ì–´ë–»ê²Œ í•˜ë‚˜ì˜ í•„ë“œë¡œ ì—¬ëŸ¬ `OAuth2Client`ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆì„ê¹Œìš”?\n\nìŠ¤í”„ë§ì€ ì˜ì¡´ì„±ì„ ì£¼ì…í•  ë•Œ ì»¬ë ‰ì…˜ìœ¼ë¡œ ì˜ì¡´ì„±ì„ ì£¼ì…í•´ ì£¼ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.\n\në”°ë¼ì„œ ë‹¤ìŒê³¼ ê°™ì´ ì—¬ëŸ¬ `OAuth2Client`ë¥¼ `List` í˜•ì‹ìœ¼ë¡œ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n```java\npublic class AuthService {\n\n    private final List<OAuth2Client> oAuth2Clients;\n\n    public AuthService(List<OAuth2Client> oAuth2Clients) {\n        this.oAuth2Clients = oAuth2Clients;\n    }\n}\n```\n\nì´ê²ƒì´ ë°”ë¡œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì˜ì¡´í•˜ê²Œ í•˜ë©´ ì–»ì„ ìˆ˜ ìˆëŠ” ê°•ë ¥í•œ ì´ì  ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤.\n\nê·¸ëŸ°ë°, ë‹¨ìˆœíˆ List íƒ€ì…ìœ¼ë¡œ ë°›ì•˜ë‹¤ê³  í•´ì„œ ëë‚˜ëŠ” ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤.\n\në¦¬ìŠ¤íŠ¸ ì¤‘ì—ì„œ ì‚¬ìš©ìê°€ ì›í•˜ëŠ” ì„œë¹„ìŠ¤ ì œê³µìë¥¼ ì„ íƒí•  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.\n\n```java\npublic OAuth2Client getClient(SocialType socialType) {\n    return oAuth2Clients.stream()\n        .filter(client -> client.getSocialType == socialType)\n        .findAny()\n        .orElseThrow(() -> BadRequestException(...));\n}\n```\n\nì´ë ‡ê²Œ Streamì„ í™œìš©í•´ì„œ ì‚¬ìš©ìê°€ ì›í•˜ëŠ” ì„œë¹„ìŠ¤ ì œê³µìë¥¼ ì„ íƒí•  ìˆ˜ ìˆê² ì§€ë§Œ, ë§¤ë²ˆ Streamì„ ì‚¬ìš©í•˜ì—¬ ì›í•˜ëŠ” ì„œë¹„ìŠ¤ ì œê³µìë¥¼ ì°¾ëŠ” ì‘ì—…ì€ ë¹„íš¨ìœ¨ì ì…ë‹ˆë‹¤.\n\nì´ë•ŒëŠ” List ìë£Œêµ¬ì¡°ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒ ë³´ë‹¤ Map ìë£Œêµ¬ì¡°ë¥¼ ì‚¬ìš©í•˜ë©´ íš¨ìœ¨ì ì¼ ê²ƒì…ë‹ˆë‹¤.\n\nìŠ¤í”„ë§ì€ Map íƒ€ì…ìœ¼ë¡œë„ ì˜ì¡´ì„± ì£¼ì…ì„ ì œê³µí•©ë‹ˆë‹¤.\n\ní•˜ì§€ë§Œ Mapìœ¼ë¡œ ì˜ì¡´ì„±ì„ ì£¼ì…ë°›ìœ¼ë©´ Keyê°€ Stringì¸ `kakaoOAuth2Client`ì™€ ê°™ì´ ì§€ì •ë©ë‹ˆë‹¤.\n\n```java\nprivate final Map<String, OAuth2Client> oAuth2ClientMap;\n```\n\në”°ë¼ì„œ ë‹¤ìŒê³¼ ê°™ì´ ì˜ì¡´ì„± ì£¼ì…ì€ Listë¡œ ë°›ì€ ë’¤, ë‚´ë¶€ì—ì„œ Mapìœ¼ë¡œ ë³€í™˜ì‹œí‚¤ë©´ Keyê°€ Enum íƒ€ì…ì¸ Mapì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n```java\nprivate final Map<SocialType, OAuth2Client> oAuth2ClientMap = new EnumMap<>(SocialType.class);\n\npublic AuthService(List<OAuth2Client> oAuth2Clients) {\n    for (OAuth2Client oAuth2Client: oAuth2Clients) {\n        oAuth2ClientMap.put(oAuth2Client.getSocialType(), oAuth2Client);\n    }\n}\n```\n\nì´ì œ ë‹¤ìŒê³¼ ê°™ì´ íŠ¹ì • í´ë¼ì´ì–¸íŠ¸ë¥¼ ë¹ ë¥´ê²Œ ì°¾ì•„ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n```java\npublic OAuth2Clients getOAuth2Client(SocialType socialType) {\n    return Optional.ofNullable(oAuth2ClientMap.get(socialType))  \n        .orElseThrow(() -> new BadRequestException(...));\n}\n```\n\ní•˜ì§€ë§Œ ì´ê²ƒ ë˜í•œ ì™„ë²½í•˜ê²Œ í•´ê²°í•œ ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤.\n\ní•„ë“œì— `OAuth2Client`ì— ëŒ€í•œ ìë£Œêµ¬ì¡°ê°€ ê·¸ëŒ€ë¡œ ë…¸ì¶œì´ ë˜ê³  ìˆìŠµë‹ˆë‹¤.\n\n`AuthService` í´ë˜ìŠ¤ì—ì„œ í•„ìš”í•œ ê¸°ëŠ¥ì€ SocialTypeì— ë§ëŠ” OAuth2Clientë§Œ ì„ íƒí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.\n\n`AuthService` í´ë˜ìŠ¤ëŠ” Mapì— ëŒ€í•œ ê¸°ëŠ¥ì„ ìì„¸íˆ ì•Œ í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤.\n\nì´ê²ƒì€ ì €í¬ê°€ ë ˆë²¨1ë¶€í„° ë°°ì›Œì˜¨ ë°©ë²•ì„ ì‚¬ìš©í•˜ë©´ ì‰½ê²Œ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\në°”ë¡œ `ì¼ê¸‰ ì»¬ë ‰ì…˜`ìœ¼ë¡œ ë§Œë“œëŠ” ê²ƒì…ë‹ˆë‹¤.\n\n```java\n@Component\npublic class OAuth2Clients {\n    private final Map<SocialType, OAuth2Client> oAuth2ClientMap = new EnumMap<>(SocialType.class);\n\n    public OAuth2Clients(List<OAuth2Client> oAuth2Clients) {\n        for (OAuth2Client oAuth2Client: oAuth2Clients) {\n            oAuth2ClientMap.put(oAuth2Client.getSocialType(), oAuth2Client);\n        }\n    }\n\n    public OAuth2Client getClient(SocialType socialType) {\n        return Optional.ofNullable(oAuth2ClientMap.get(socialType))  \n            .orElseThrow(() -> new BadRequestException(...));\n    }\n}\n```\n\nê·¸ë¦¬ê³  `AuthService`ì˜ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ì´ ë³€í•©ë‹ˆë‹¤.\n\n```java\n@Service\n@Transactional\npublic class AuthService {\n    private final OAuth2Clients oAuth2Clients;\n\n    ...\n\n    public LoginResponse login(SocialType socialType, String code) {  \n        OAuth2Client oAuth2Client = oAuth2Clients.getClient(socialType);\n        String accessToken = oAuth2Client.getAccessToken(code);  \n        UserInfo userInfo = oAuth2Client.getUserInfo(accessToken);  \n        Member member = memberRepository.findBySocialIdAndSocialType(userInfo.socialId(), socialType)  \n            .orElseGet(() -> memberRepository.save(userInfo.toMember()));  \n        return new LoginResponse(authProvider.provide(member), userInfo.nickname());  \n    }  \n} \n```\n\nì´ì œ ìƒˆë¡œìš´ OAuth2Clientê°€ ì¶”ê°€ë˜ì–´ë„ ê¸°ì¡´ì˜ ì½”ë“œë¥¼ ë³€ê²½í•  í•„ìš”ëŠ” ì „í˜€ ì—†ì–´ì§‘ë‹ˆë‹¤.\n\në˜í•œ ë¡œì»¬ í™˜ê²½ ë˜ëŠ” í…ŒìŠ¤íŠ¸ í™˜ê²½ì„ ìœ„í•œ ëª¨ì˜ OAuth2Clientë¥¼ ë§Œë“¤ë”ë¼ë„ `@Profile`  ì–´ë…¸í…Œì´ì…˜ì˜ ì‚¬ìš©ìœ¼ë¡œ ìš´ì˜ í™˜ê²½ì—ì„œëŠ” ì „í˜€ ì˜í–¥ì„ ì£¼ì§€ ì•Šê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n```java\n@Component  \n@Profile(\"!prod\")  \npublic class FestagoOAuth2Client implements OAuth2Client {  \n  \n    private static final String PROFILE_IMAGE = \"https://placehold.co/150x150\";  \n  \n    private final Map<String, UserInfo> userInfoMap = new HashMap<>();  \n  \n    public FestagoOAuth2Client() {  \n        userInfoMap.put(\"1\", new UserInfo(\"1\", getSocialType(), \"member1\", PROFILE_IMAGE));  \n        userInfoMap.put(\"2\", new UserInfo(\"2\", getSocialType(), \"member2\", PROFILE_IMAGE));  \n        userInfoMap.put(\"3\", new UserInfo(\"3\", getSocialType(), \"member3\", PROFILE_IMAGE));  \n    }  \n  \n    @Override  \n    public UserInfo getUserInfo(String accessToken) {  \n        return Optional.ofNullable(userInfoMap.get(accessToken))\n            .orElseThrow(() -> new BadRequestException(...));\n    }  \n  \n    @Override  \n    public SocialType getSocialType() {  \n        return SocialType.FESTAGO;  \n    }  \n}\n```\n\n## ê²°ë¡ \n\nOAuth2ë¥¼ ì‚¬ìš©í•œ ì¸ì¦ ê¸°ëŠ¥ì„ êµ¬í˜„í•  ë•Œ, ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” ì˜ì¡´ì„± ì£¼ì… ê¸°ëŠ¥ê³¼ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•œ ë‹¤í˜•ì„± í™œìš© ë“±, ê°ì²´ ì§€í–¥ ì„¤ê³„ë¥¼ ë”°ë¼ ì½”ë“œë¥¼ êµ¬í˜„í•˜ë©´ ë³€ê²½ì— ìœ ì—°í•˜ê³  ê°€ë…ì„±ì´ ë†’ì€ ì½”ë“œë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\nì €í¬ ì„œë¹„ìŠ¤ íŠ¹ì„±ìƒ ìƒˆë¡œìš´ OAuth2 ì„œë¹„ìŠ¤ ì œê³µìê°€ ì¶”ê°€ë  í™•ë¥ ì€ ë‚®ê² ì§€ë§Œ, ë ˆë²¨ 1, 2 ê³¼ì •ì„ ë°°ìš°ë©° ìŠµë“í•œ ê°ì²´ ì§€í–¥ ì„¤ê³„ ì›ì¹™ì„ ì´ë ‡ê²Œ ì„œë¹„ìŠ¤ì— ë…¹ì—¬ëƒˆë‹¤ëŠ” ì ì´ ë¿Œë“¯í•œ ê²ƒ ê°™ìŠµë‹ˆë‹¤.\n\n"}]}},"pageContext":{}},"staticQueryHashes":[],"slicesMap":{}}