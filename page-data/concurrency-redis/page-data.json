{"componentChunkName":"component---src-templates-post-jsx","path":"/concurrency-redis/","result":{"data":{"site":{"siteMetadata":{"title":"Festago"}},"markdownRemark":{"id":"b2e904f3-69c7-5c99-96e7-9555aaddc0e2","excerpt":"ì•ˆë…•í•˜ì„¸ìš”. í˜ìŠ¤íƒ€ê³ ì˜ ì• ì‰¬ ì…ë‹ˆë‹¤. ğŸ¹ â€˜ëŒ€í•™ ì¶•ì œ ì¤„ì„œê¸° ì„œë¹„ìŠ¤â€™ í˜ìŠ¤íƒ€ê³ ë¥¼ ê°œë°œí•˜ë©°, í‹°ì¼“íŒ… ìƒí™©ì—ì„œ ë™ì‹œì„± ë³´ì¥ì„ ìœ„í•´ Redisë¥¼ ë„ì…í•´ë³´ì•˜ìŠµë‹ˆë‹¤. ì•„ë˜ëŠ” ì €í¬ íŒ€ì˜ ìš”êµ¬ì‚¬í•­ê³¼ ë¬¸ì œ ìƒí™©, ê·¸ë¦¬ê³  í•´ë‹¹ ë¬¸ì œ ìƒí™©ì˜ í•´ê²°ì±…ìœ¼ë¡œ Redisë¥¼ ë„ì…í•œ ì´ìœ ì…ë‹ˆë‹¤. 1. ìš”êµ¬ì‚¬í•­ í‹°ì¼“ì€ ì§€ì •ëœ ìˆ˜ëŸ‰ë§Œí¼ë§Œ ë°œê¸‰ë˜ì–´ì•¼í•©ë‹ˆë‹¤. 2. ë¬¸ì œ ìƒí™© ë™ì‹œì— ì—¬ëŸ¬ ì‚¬ìš©â€¦","html":"<p>ì•ˆë…•í•˜ì„¸ìš”. í˜ìŠ¤íƒ€ê³ ì˜ ì• ì‰¬ ì…ë‹ˆë‹¤. ğŸ¹</p>\n<p>â€˜ëŒ€í•™ ì¶•ì œ ì¤„ì„œê¸° ì„œë¹„ìŠ¤â€™ í˜ìŠ¤íƒ€ê³ ë¥¼ ê°œë°œí•˜ë©°, í‹°ì¼“íŒ… ìƒí™©ì—ì„œ ë™ì‹œì„± ë³´ì¥ì„ ìœ„í•´ Redisë¥¼ ë„ì…í•´ë³´ì•˜ìŠµë‹ˆë‹¤.</p>\n<p>ì•„ë˜ëŠ” ì €í¬ íŒ€ì˜ ìš”êµ¬ì‚¬í•­ê³¼ ë¬¸ì œ ìƒí™©, ê·¸ë¦¬ê³  í•´ë‹¹ ë¬¸ì œ ìƒí™©ì˜ í•´ê²°ì±…ìœ¼ë¡œ Redisë¥¼ ë„ì…í•œ ì´ìœ ì…ë‹ˆë‹¤.</p>\n<h2>1. ìš”êµ¬ì‚¬í•­</h2>\n<p>í‹°ì¼“ì€ ì§€ì •ëœ ìˆ˜ëŸ‰ë§Œí¼ë§Œ ë°œê¸‰ë˜ì–´ì•¼í•©ë‹ˆë‹¤.</p>\n<h2>2. ë¬¸ì œ ìƒí™©</h2>\n<p>ë™ì‹œì— ì—¬ëŸ¬ ì‚¬ìš©ìê°€ ì˜ˆë§¤í•  ë•Œ, ì§€ì •ëœ ìˆ˜ëŸ‰ë³´ë‹¤ ë” ë§ì€ ìˆ˜ëŸ‰ì˜ í‹°ì¼“ì´ ì˜ˆë§¤ë©ë‹ˆë‹¤.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/d684b93fc5d21695c9ac0da8753c0cf7/bbbf7/%EB%AC%B8%EC%A0%9C%EC%83%81%ED%99%A9.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 85.29411764705883%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAAsTAAALEwEAmpwYAAACaklEQVR42m1TS2/TQBDuBYl/wAUO/AtuPcGtV/5CJS4IgUAVByQOIHHgUnEAJMoRIaCiKm2J05ZCyatp3jSkTe36lTgvp37sehPbu4ztNGpDPtmr2W/m087szM6wEL7vNxqNTgjHIcDwJqubgctGCFzdbhdWz/PYOcyMrWKpFIvF0pnMqWkpmMVVGldoAzPYplJJjuPS6fRwOJwippTCqmgtMhj4lDpDVydMw8wNaEYI0TRtHHZB7IdMpU9vrQ/elszyXiKXz99N+fNJ5oUuhJAoitPFUURcJNeX2T2uWd1PCkrz5oY7u8EcLxJjWZaniwFOAFwQWhYmESPZrGaM0gKfIKnTxUD1dR0MVVUgwyCC0sf7/p0Mq9TqxUxipSDOcf5KeLZHJ9L2PL3XC8SKjDEGY+jT2zts9jutSZp69Of5au7aMntRIJNiP2gydTCqHvGvd2r5Y/VE4JlLNo6tV5lWFIQdkuVbyCG2bV1Iu4lYvlr/W9hb+lm9/HBr/v0uXy1/W1u78Wz96pPto44dzImNICkwDMOAVo9HZQYuxPU86rk97C58LWXFIH+X4NWD9mJCpWEboRZFHonBdl132pDIkhPWDChrKHZsIMs8EYSWfrq0e3iodsx+bxT/v1iUFXQmnnuTvbLAvXz34SD7e5ErX7off/S5oPcNga83VHnKyZIk4TPxp3L76aZgI9hSvm08+FIstpycRrbK4o9q49Bg/cFE2ooC8xAxlss6I5NBLYpQh778atJMj21r7CMfPLsLYng6cCURU9FpvjvqqWlaXHzzLCz8J54koN1uj29y4AffGBODGdX8D8Ncra8uo+sNAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='    ' title='' src='/static/d684b93fc5d21695c9ac0da8753c0cf7/ca1dc/%EB%AC%B8%EC%A0%9C%EC%83%81%ED%99%A9.png' srcset='/static/d684b93fc5d21695c9ac0da8753c0cf7/e7570/%EB%AC%B8%EC%A0%9C%EC%83%81%ED%99%A9.png 170w,\n/static/d684b93fc5d21695c9ac0da8753c0cf7/f46e7/%EB%AC%B8%EC%A0%9C%EC%83%81%ED%99%A9.png 340w,\n/static/d684b93fc5d21695c9ac0da8753c0cf7/ca1dc/%EB%AC%B8%EC%A0%9C%EC%83%81%ED%99%A9.png 680w,\n/static/d684b93fc5d21695c9ac0da8753c0cf7/02d09/%EB%AC%B8%EC%A0%9C%EC%83%81%ED%99%A9.png 1020w,\n/static/d684b93fc5d21695c9ac0da8753c0cf7/bbbf7/%EB%AC%B8%EC%A0%9C%EC%83%81%ED%99%A9.png 1280w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<h2>3. ì§€ê¸ˆê¹Œì§€ì˜ í•´ê²°ì±…</h2>\n<p>í‹°ì¼“ ìˆ˜ëŸ‰ì˜ ì •í•©ì„±ì„ ë³´ì¥í•˜ê¸° ìœ„í•˜ì—¬, <strong>ë¹„ê´€ì  ë½</strong>ì„ ì ìš©í–ˆìŠµë‹ˆë‹¤.</p>\n<p>í•˜ì§€ë§Œ ë¹„ê´€ì  ë½ì€ ë½ì„ ì–»ê¸° ìœ„í•œ ëŒ€ê¸°ì‹œê°„ì´ ë°œìƒí•˜ê¸° ë•Œë¬¸ì— ì„±ëŠ¥ì ìœ¼ë¡œ ì¢‹ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>\n<h3>3-1. ì„±ëŠ¥ ê°œì„ ì±…</h3>\n<h4>âœ… TicketAmount í…Œì´ë¸” ë¶„ë¦¬</h4>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/78e98164ed9d5e19c83cd23c30ad79cb/bbbf7/ticket%EB%8F%84%EB%A9%94%EC%9D%B8%EA%B5%AC%EC%A1%B0.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 68.82352941176471%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABfklEQVR42p2TWavCQAyF5///rSJYaFFcccEnd6t1b13aI19gxIfbh9vA0Gkmc3JyknGqYY/HQ6fTSev1WpvNRvv9XufzWe/3W+6/YEVR6HK56H6/q9vtqtFoqN1u63a76Xq9yr1eL0Mn6Pl8WiCHZVn+CQiLNE3FPWJ+F6wdQIfDwbKEYahWq2WgWZZVAlLiZDLRfD7X8Xg0P4BgOdhQBrpwiJNL+KsAiRmPx0ag3+8bIcxKhj4bn8WLzqVfnzf+SZbn+Vci9mDgd4vFQnEcazQafUEIQFeflcUZJe52OwMlBrDlcml6EkOlbrvdmm6dTse+jAGXEdiXSCALANh7iQBNkuSrOYncarUyLWAZBIF6vZ6JXlUyBvvZbKbpdKrBYGANQlPuOaiSiUUWslOCb0qVhsQCTCVo6YfdugwAThZ7Dqq6jNFIGA2HQ2PHdEDMAGFENj/p7Ktm0BsAzG0URWo2myYXzYKxq/OW0dePCXvKpXm1AQHwzxW2APOlDx++dzpK6EtbuQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='ticket     ' title='' src='/static/78e98164ed9d5e19c83cd23c30ad79cb/ca1dc/ticket%EB%8F%84%EB%A9%94%EC%9D%B8%EA%B5%AC%EC%A1%B0.png' srcset='/static/78e98164ed9d5e19c83cd23c30ad79cb/e7570/ticket%EB%8F%84%EB%A9%94%EC%9D%B8%EA%B5%AC%EC%A1%B0.png 170w,\n/static/78e98164ed9d5e19c83cd23c30ad79cb/f46e7/ticket%EB%8F%84%EB%A9%94%EC%9D%B8%EA%B5%AC%EC%A1%B0.png 340w,\n/static/78e98164ed9d5e19c83cd23c30ad79cb/ca1dc/ticket%EB%8F%84%EB%A9%94%EC%9D%B8%EA%B5%AC%EC%A1%B0.png 680w,\n/static/78e98164ed9d5e19c83cd23c30ad79cb/02d09/ticket%EB%8F%84%EB%A9%94%EC%9D%B8%EA%B5%AC%EC%A1%B0.png 1020w,\n/static/78e98164ed9d5e19c83cd23c30ad79cb/bbbf7/ticket%EB%8F%84%EB%A9%94%EC%9D%B8%EA%B5%AC%EC%A1%B0.png 1280w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>Ticket í…Œì´ë¸”ì—ì„œ ìˆ˜ëŸ‰ ì •ë³´ë¥¼ TicketAmount í…Œì´ë¸”ë¡œ ë¶„ë¦¬í•œ í›„, í•´ë‹¹ í…Œì´ë¸”ì—ë§Œ ë¹„ê´€ì  ë½ì„ ì ìš©í•¨ìœ¼ë¡œì¨ <strong>ë½ ë²”ìœ„ë¥¼ ìµœì†Œí™”</strong>í–ˆìŠµë‹ˆë‹¤.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/da1c613727496495ca18fac06fa65d80/bbbf7/lock%EB%B2%94%EC%9C%84.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 57.05882352941176%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACUUlEQVR42kWS32vTUBTH85/Imqbtktyb3zfprzRpx+oy9qBsuO5hWnEDmb6Ij/4L4vbStZn1QVAQXxSEwagwt7XbhIEoPohdnwSZKNvSJF1xbb3pUA8fDpfv4Xu495xLfPz0Yae+2dit1xuNjVrt3dbW1vb27t7+12azeXiIOWy1/tFstfxOZ/A3iJnJbJqP6rKYEnhTAhmJS/CCBhiVZRBNI4bmKZIPk0I4yHxoZK/RwLZerxeYr1lWQk2kdDOd1k3DyOh6Iq6JAsdDCFkGMDRLBwA6CETHahtvsK3f7wfm6ct5JIrxlKnG00o8oaZ0LZkUFSQhBHmO5fgAyEFBGIUcYpiXz5e7XWcwbEDMz1zNq7KVMSzDtIzMpGlYGT2nKtkAlNPUC8biWlZTxxXpYG///7U9v+O2Xd9t+22nfXLinp56jtPx3DPPO/NcXMMl5/gY677j+L7Xc9uDjj84P8cNiNevXtiVR+VyqVKx7UrZtu1q9UmptLqKpVLJXlvDLK+slMtlLD2uVn8cHQ2+fO7WN3vfvxFWPgc4ICKVl2SEBEkRoSDTkI0xTJRmYzQdCodJiiLDVIgMXyLJnbe1gev8/vWz77nE9NTUWDI5kRvLGwbOE2Z2PJ3QFTktS3EeqIDVINQg0DioAaByYHd9PXjzxbSvmBk5ElF4WeFECUIkSggvapTm8IaiFBuNspEIQ0VALBajKDk08uzpw7PhtPG2iAf3790uzN4pFjFLxRt3bxaXrs8vzs3eKswuzBUW5woLQy4Oi4XCwfvtoTP4YX8AHmJDWx67TJ4AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='lock  ' title='' src='/static/da1c613727496495ca18fac06fa65d80/ca1dc/lock%EB%B2%94%EC%9C%84.png' srcset='/static/da1c613727496495ca18fac06fa65d80/e7570/lock%EB%B2%94%EC%9C%84.png 170w,\n/static/da1c613727496495ca18fac06fa65d80/f46e7/lock%EB%B2%94%EC%9C%84.png 340w,\n/static/da1c613727496495ca18fac06fa65d80/ca1dc/lock%EB%B2%94%EC%9C%84.png 680w,\n/static/da1c613727496495ca18fac06fa65d80/02d09/lock%EB%B2%94%EC%9C%84.png 1020w,\n/static/da1c613727496495ca18fac06fa65d80/bbbf7/lock%EB%B2%94%EC%9C%84.png 1280w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<h4>âœ… N+1 ì¿¼ë¦¬ ì œê±°</h4>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/aa2c9cdd05f32ba9e376cb6fab0d3eaa/dc992/n%2B1.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 29.411764705882355%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA/0lEQVR42pWQXW6DMBAGOU2jBox/sXEIAQIkoal6/9tMN02lPrZ9GK3X1jdab5HSjpx3WFdSKoWq9pSVnKvqm/JfFGFyzBfDdjX0S8OyGIbbwHCfCVPEHC22d7iT/xOFnRqGi+d9E+lNi6zlvF0Yt5l2yeTlQFozYY74c/iVwo5BJrTcr5pRgt16kOlWlo83TjeRnjvyesRPCTdIaPzBjf7J8KyPu+LxrdgH2lZjQ8A4S4iGmNxXdV7Jfit5K9FOUdua2tUoQTstGIy3kjMorSh8aEi5o2mCSBLeOfqomDvDfDCMrew2VXT5BR9eRVCLQKRWSR8JIZHajih5Ve75BHQDwzS8EKi6AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='n 1' title='' src='/static/aa2c9cdd05f32ba9e376cb6fab0d3eaa/ca1dc/n%2B1.png' srcset='/static/aa2c9cdd05f32ba9e376cb6fab0d3eaa/e7570/n%2B1.png 170w,\n/static/aa2c9cdd05f32ba9e376cb6fab0d3eaa/f46e7/n%2B1.png 340w,\n/static/aa2c9cdd05f32ba9e376cb6fab0d3eaa/ca1dc/n%2B1.png 680w,\n/static/aa2c9cdd05f32ba9e376cb6fab0d3eaa/02d09/n%2B1.png 1020w,\n/static/aa2c9cdd05f32ba9e376cb6fab0d3eaa/dc992/n%2B1.png 1178w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\nFetch Joinì„ í™œìš©í•´ N+1 ì¿¼ë¦¬ë¥¼ ì œê±°í–ˆìŠµë‹ˆë‹¤.</p>\n<p>â‡’ ê²°ê³¼ì ìœ¼ë¡œ <strong>10% ì •ë„ì˜ ì„±ëŠ¥ ê°œì„ </strong>ì„ ì´ë£¨ì–´ë‚¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</p>\n<h2>4. ì•ìœ¼ë¡œì˜ ì„±ëŠ¥ ê°œì„ ì±…</h2>\n<p>ì„œë²„ ë‹¨ì—ì„œ ì„±ëŠ¥ í–¥ìƒì„ ìœ„í•´ ì¼ë°˜ì ìœ¼ë¡œ ìºì‹±ê³¼ DB ì¸ë±ìŠ¤ë¥¼ í™œìš©í•˜ê³¤ í•©ë‹ˆë‹¤.</p>\n<p>í•˜ì§€ë§Œ í‹°ì¼“ ì˜ˆë§¤ ë¡œì§ì—ì„œ ê°€ì¥ í° ë³‘ëª©ì€ ë°ì´í„°ì˜ ì¡°íšŒê°€ ì•„ë‹Œ <strong>Lockì„ ì–»ê¸° ìœ„í•œ ëŒ€ê¸°ë¡œ ì¸í•´ ë°œìƒ</strong>í•©ë‹ˆë‹¤.</p>\n<p>ë”°ë¼ì„œ, <strong>ê°€ëŠ¥í•œ Lockì„ ê±¸ì§€ ì•ŠëŠ” ê²ƒ</strong>ì´ ì„±ëŠ¥ì„ í–¥ìƒ ì‹œí‚¤ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.</p>\n<p>ì €í¬ëŠ” <strong>DBì˜ í‹°ì¼“ ìˆ˜ëŸ‰ì„ ë³€ê²½</strong>í•  ë•Œ, ì •í•©ì„±ì„ ë³´ì¥í•˜ê¸° ìœ„í•´ì„œ Lockì„ ê²ë‹ˆë‹¤.</p>\n<p>ë”°ë¼ì„œ, <strong>DBì˜ í‹°ì¼“ ìˆ˜ëŸ‰ì„ ë³€ê²½í•˜ì§€ ì•ŠëŠ” í•´ê²°ì±…</strong>ì„ ì°¾ê³ ì í–ˆìŠµë‹ˆë‹¤.</p>\n<h3>4-1. AtomicIntegerì˜ í™œìš©</h3>\n<p>ì²«ë²ˆì§¸ í•´ê²°ì±…ìœ¼ë¡œ AtomicIntegerë¥¼ í™œìš©í•´ <strong>ë©”ëª¨ë¦¬ì—ì„œ í‹°ì¼“ì˜ ìˆ˜ëŸ‰ì„ ë³€ê²½í•˜ê³  ê´€ë¦¬</strong>í•˜ê³ ì í–ˆìŠµë‹ˆë‹¤.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/47a0c66aa6ebe21a927c4353a6285665/1d574/atomicInteger.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 42.94117647058824%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB9UlEQVR42jWRy28SURjF509wJdZEEjvAPC4tc5kHj2HowFCif4AubO3KUCkG3JgZusDYunDZvYlaGFi61rWPnVFiY7GmCyvGRYUqILYduNc70/jll3O+zUnu+S7Vaj5utex6vW7Xt+uNRsO2m3az2Wy5tv3UfkZ4csbPXh9jfDr+44xHZJkgTHEcE4lKEQhlKSJAgQOADgVpOjAbZC9ykZnQ3ExonuALgDftzneEX3f7bw8OPxyddseIiifUTC6f1g3dWNSzWTWlxhJJRYZg4eqllU3/Us2/8sC/XPNdrz5/f/Cyhx7tDbf2R1ud/pehQ4UZVpaTohgTJVmKJSCEPA94nmc5niPKEucZlmOC9LudXfJajByEp8RGDqLMe3fXq5ZlWt6YlnmG5er/IVvVMve7P7wwQq7hkYMpXY8b+XzWyF7J60Yut5DJqloqqWqqqsZjkiJFFUmUJVERYXt3j2Sc6XTi5YckLCqJlG6k0rqmZ7S0piiyIEpwHrDq4vmbD303ar7ljQtL989dWyedX/RRdedo49OvzY+HnwduZ4Z0hlCBkiwqcUEQeBBmeTbAhQNzURoIRGeBcJkFr9qd3xgPjp3ByWR44vSOEVUs3CpXKuUygUzlTqlULBbXPEq3Vz0KRNdWC1+/dd1/niBnisnR/k7wPw7ECod7zhyiAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='atomicInteger' title='' src='/static/47a0c66aa6ebe21a927c4353a6285665/ca1dc/atomicInteger.png' srcset='/static/47a0c66aa6ebe21a927c4353a6285665/e7570/atomicInteger.png 170w,\n/static/47a0c66aa6ebe21a927c4353a6285665/f46e7/atomicInteger.png 340w,\n/static/47a0c66aa6ebe21a927c4353a6285665/ca1dc/atomicInteger.png 680w,\n/static/47a0c66aa6ebe21a927c4353a6285665/02d09/atomicInteger.png 1020w,\n/static/47a0c66aa6ebe21a927c4353a6285665/9d567/atomicInteger.png 1360w,\n/static/47a0c66aa6ebe21a927c4353a6285665/1d574/atomicInteger.png 1510w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>ì´ ë°©ë²•ì€ DBì˜ ë°ì´í„°ë¥¼ ê°±ì‹ í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì—, ë™ì‹œ ì˜ˆë§¤ ìƒí™©ì—ì„œ ë°œìƒí•˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>\n<p>ì§€ê¸ˆì˜ ë‹¨ì¼ ì„œë²„ì—ì„œëŠ” ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•Šì§€ë§Œ, ë¬´ì¤‘ë‹¨ ë°°í¬ë¥¼ ìœ„í•œ ë‹¤ì¤‘ ì„œë²„ í™˜ê²½ì—ì„œëŠ” ë©”ëª¨ë¦¬ ê³µìœ  ë¬¸ì œê°€ ë°œìƒí•©ë‹ˆë‹¤.</p>\n<p>í‹°ì¼“ì˜ ìˆ˜ëŸ‰ì€ ë‹¨ìˆœíˆ ì¡°íšŒí•˜ëŠ” ê°’ì´ ì•„ë‹Œ ë§¤ ìš”ì²­ë§ˆë‹¤ ë³€ê²½ë˜ëŠ” ê°’ì´ê¸° ë•Œë¬¸ì— ë™ê¸°í™”ì—ì„œ ë¬¸ì œ ë°œìƒì´ ìš°ë ¤ë©ë‹ˆë‹¤.</p>\n<h3>4-2. Redis í™œìš©</h3>\n<p>AtomicIntegerì˜ ëŒ€ì²´ì œë¡œ Redisë¥¼ í™œìš©í–ˆìŠµë‹ˆë‹¤.</p>\n<p>RedisëŠ” ì‹±ê¸€ ìŠ¤ë ˆë“œì´ë©° multiplexing ê¸°ìˆ ì„ í™œìš©í•˜ì—¬ ë‹¨ì¼ í”„ë¡œì„¸ìŠ¤ê°€ ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ëª¨ë“  ìš”ì²­ì´ ìˆœì°¨ì ìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤.</p>\n<p>ë„¤íŠ¸ì›Œí¬ I/Oê°€ ì¡´ì¬í•˜ì§€ë§Œ, ê·¸ëŸ¼ì—ë„ DBì— ë½ì„ ê±°ëŠ” ê²ƒ ë³´ë‹¤ ì„±ëŠ¥ì´ í›¨ì”¬ ë›°ì–´ë‚©ë‹ˆë‹¤.</p>\n<p>3000ê°œì˜ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ”ë° DB ë½ì„ í™œìš©í•œ ë°©ë²•ì€ í‰ê·  12800msê°€ ì†Œìš”ë˜ëŠ” ë°˜ë©´, Redisë¥¼ í™œìš©í•œ ë°©ë²•ì€ í‰ê·  7500msì´ ì†Œìš”ë©ë‹ˆë‹¤. ì´ëŠ” <strong>40% ì´ìƒì˜ ì„±ëŠ¥ ê°œì„ </strong>ì…ë‹ˆë‹¤.</p>\n<table>\n<thead>\n<tr>\n<th>DB ë½</th>\n<th>Redis</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>12764</td>\n<td>8249</td>\n</tr>\n<tr>\n<td>14217</td>\n<td>7350</td>\n</tr>\n<tr>\n<td>12177</td>\n<td>7123</td>\n</tr>\n<tr>\n<td>11969</td>\n<td>7414</td>\n</tr>\n</tbody>\n</table>\n<h2>5. Redis í™œìš©ë²•</h2>\n<p>êµ¬ì²´ì ì¸ Redis í™œìš©ë²•ì„ ì•Œì•„ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/40c2ae3dc25d969899a74aea4e565223/52c6a/%ED%8B%B0%EC%BC%93%EB%93%B1%EB%A1%9D.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 43.529411764705884%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABVklEQVR42oVSSU7DQBD0czjyIE78hEsOPIknIK6YRHIUKYmyOYnteN+mqGoyChyAkSqZ6emu7qpxkKYpttutYbfb4d/l3J/XweFwMCJPWte1oaqqG8oSTdui7Tp0w4Caew/Fm6axGsdmwTiOtvEYWCAoLgx9b52z9xAfD4+IJs8Y8hz9OUF/uaCnQsecko2VH3yp+F2GY5LW+fUNL3f3CJ8mQJJgJNGw32M8HgFOrgmNUONmWQZ5KeTsLijes7Om7SWTOR3jov+uomOeIwraolig4iiKMJvNsFqtMJ/PMZ1OEcex+SfilGSbxQIner3ebLBkXnw6oeLdernEUBQ3Qv2UPIRhaEQLFoqoo4wfi3mOeaO8yi8YSQI9BGO4chihCuWhJi2YJC9MJuXqrtXrEtp3+q8bk2ng2WyhdBGah5pGJO31+XUWsYf31KAzoWLB13q/9R1+At7ptX8spVXMAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='    ' title='' src='/static/40c2ae3dc25d969899a74aea4e565223/ca1dc/%ED%8B%B0%EC%BC%93%EB%93%B1%EB%A1%9D.png' srcset='/static/40c2ae3dc25d969899a74aea4e565223/e7570/%ED%8B%B0%EC%BC%93%EB%93%B1%EB%A1%9D.png 170w,\n/static/40c2ae3dc25d969899a74aea4e565223/f46e7/%ED%8B%B0%EC%BC%93%EB%93%B1%EB%A1%9D.png 340w,\n/static/40c2ae3dc25d969899a74aea4e565223/ca1dc/%ED%8B%B0%EC%BC%93%EB%93%B1%EB%A1%9D.png 680w,\n/static/40c2ae3dc25d969899a74aea4e565223/02d09/%ED%8B%B0%EC%BC%93%EB%93%B1%EB%A1%9D.png 1020w,\n/static/40c2ae3dc25d969899a74aea4e565223/9d567/%ED%8B%B0%EC%BC%93%EB%93%B1%EB%A1%9D.png 1360w,\n/static/40c2ae3dc25d969899a74aea4e565223/52c6a/%ED%8B%B0%EC%BC%93%EB%93%B1%EB%A1%9D.png 1452w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<h3>(1) í‹°ì¼“ ë“±ë¡ì‹œ Redisì— ê°’ ë„£ì–´ì£¼ê¸°</h3>\n<p>í‹°ì¼“ì„ ë“±ë¡í•˜ë©´, (<code class=\"language-text\">ticketAmount_ticketId</code>, <code class=\"language-text\">ticketAmount</code>) ë°ì´í„°ë¥¼ Redisì— ë“±ë¡í•©ë‹ˆë‹¤.\n(ì¶”ê°€ ìˆ˜ëŸ‰ ë°œê¸‰ì‹œ, ticketAmountë¥¼ ì¶”ê°€ ìˆ˜ëŸ‰ë§Œí¼ ë”í•´ì¤ë‹ˆë‹¤.)</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">updateTicketAmount</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">TicketAmountChangeEvent</span> ticketAmountChangeEvent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Long</span> ticketId <span class=\"token operator\">=</span> ticketAmountChangeEvent<span class=\"token punctuation\">.</span><span class=\"token function\">ticketId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">Integer</span> ticketAmount <span class=\"token operator\">=</span> ticketAmountChangeEvent<span class=\"token punctuation\">.</span><span class=\"token function\">ticketAmount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ticketAmount_\"</span> <span class=\"token operator\">+</span> ticketId<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> ticketAmount<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>(2) í‹°ì¼“íŒ…ì‹œ Redisì—ì„œ ìˆ˜ëŸ‰ ê´€ë¦¬í•˜ê¸°</h3>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/5ab4ac3136879a16bd1f7ec27247a343/e8464/%ED%8B%B0%EC%BC%93%ED%8C%85.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 62.94117647058823%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB80lEQVR42pVTy2rcQBDUPbdAbvm/nPI7vvgvAiHkZBMwxpBTjsm+d6XVY7U7Wkmjt8pVo2xIgg32QDOjme7qrq6Wh2fWOI7/2jC4+3q7Q3h1DXP/ICcM1mJsGoxd5949vHBdAINPn/Hl7XusCAqCDKcT+jDEkOcugWeZ4Xw+O8uyzFlRFNjtdoiiCPv9Huv1Gr7vI6NPy7dwNkNIkCgIoHhDUMMzmNRLkgTz+RyLxQIBL3XebDbQfZqmONFZ++FwwHK1QnE8oiGIrWuUmYFlXM1ENf1UsdeQv6qZMavAVJGyClD7kQDGGHcuaW1ZwhA85ntCBkqgyi139P3Uw47ILoDOSqA1/O5ZVVV/7tw9z5b9KkldYBXPqrBVherhRcX/1X1KdbeL6rc7VD9/TQ9t6yobaa9TuZ8qPj58x9c37/Djw0egyNGz7x1F60VZgKIrqqKcs3ztPbNJCPVPosRx7ERRDzV3m5tbpOy7ZVzF75ptGdgC10MFbLdbJ4hTcrl03xqLiwkwpgA+BYtYTX7OkJiTGxsj5RnXE9gBau4Ecpm1FR00PgJSlX/PpuFuqXhDJhXF0fhUVLsVK1bpAEVRo6JgjYqGWWe1QtRriiAfqT5IMIqQMnFAyj6ZGLal5nujHmqw8doltbtJWegftiXNTmoDeAToeeM2W0k0dAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='   ' title='' src='/static/5ab4ac3136879a16bd1f7ec27247a343/ca1dc/%ED%8B%B0%EC%BC%93%ED%8C%85.png' srcset='/static/5ab4ac3136879a16bd1f7ec27247a343/e7570/%ED%8B%B0%EC%BC%93%ED%8C%85.png 170w,\n/static/5ab4ac3136879a16bd1f7ec27247a343/f46e7/%ED%8B%B0%EC%BC%93%ED%8C%85.png 340w,\n/static/5ab4ac3136879a16bd1f7ec27247a343/ca1dc/%ED%8B%B0%EC%BC%93%ED%8C%85.png 680w,\n/static/5ab4ac3136879a16bd1f7ec27247a343/02d09/%ED%8B%B0%EC%BC%93%ED%8C%85.png 1020w,\n/static/5ab4ac3136879a16bd1f7ec27247a343/9d567/%ED%8B%B0%EC%BC%93%ED%8C%85.png 1360w,\n/static/5ab4ac3136879a16bd1f7ec27247a343/e8464/%ED%8B%B0%EC%BC%93%ED%8C%85.png 1536w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>Redisì˜ DECR ì—°ì‚°ìœ¼ë¡œí‹°ì¼“íŒ…ì—ì„œ í•´ë‹¹ í‹°ì¼“ì˜ ì”ì—¬ ìˆ˜ëŸ‰ì„ ì¡°íšŒí•¨ê³¼ ë™ì‹œì—, ì”ì—¬ ìˆ˜ëŸ‰ì„ 1 ê°ì†Œí•©ë‹ˆë‹¤.</p>\n<p>ì´ ë•Œ, ì”ì—¬ ìˆ˜ëŸ‰ \"ì¡°íšŒ\"ì™€ \"1 ê°ì†Œ\"ëŠ” ì›ìì ì¸ ë‹¨ìœ„ë¡œ ì´ë£¨ì–´ì ¸ ë™ì‹œì„± ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token class-name\">Optional</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getSequence</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Ticket</span> ticket<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Integer</span> totalAmount <span class=\"token operator\">=</span> ticket<span class=\"token punctuation\">.</span><span class=\"token function\">getTicketAmount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTotalAmount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">Long</span> quantity <span class=\"token operator\">=</span> <span class=\"token function\">getQuantity</span><span class=\"token punctuation\">(</span>ticket<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>quantity <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> quantity <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">Optional</span><span class=\"token punctuation\">.</span><span class=\"token function\">empty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">Optional</span><span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span>totalAmount <span class=\"token operator\">-</span> quantity<span class=\"token punctuation\">.</span><span class=\"token function\">intValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>ì”ì—¬ ìˆ˜ëŸ‰ì´ 0 ì´ìƒì´ë©´, í‹°ì¼“íŒ…ì— ì„±ê³µí•œ ê²ƒìœ¼ë¡œ ì´ ìˆ˜ëŸ‰ì—ì„œ ì”ì—¬ ìˆ˜ëŸ‰ì„ ë¹¼ í‹°ì¼“ ìˆœë²ˆì„ ê²°ì •í•©ë‹ˆë‹¤.</p>\n<p>ì”ì—¬ ìˆ˜ëŸ‰ì´ 0ë³´ë‹¤ ì ìœ¼ë©´ ì´ëŠ” í’ˆì ˆëœ ê²ƒìœ¼ë¡œ, í‹°ì¼“íŒ…ì— ì‹¤íŒ¨í•©ë‹ˆë‹¤.</p>\n<h2>6. ì¶”ê°€ì ì¸ í™œìš©ë²•</h2>\n<p>ì €í¬ ì„œë¹„ìŠ¤ì˜ ìš”êµ¬ì‚¬í•­ìœ¼ë¡œ, í•œ ì‚¬ìš©ìëŠ” íŠ¹ì • ë¬´ëŒ€ì— ëŒ€í•´ í•œ ì¥ì˜ í‹°ì¼“ë§Œ ë°œê¸‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<p>í•˜ì§€ë§Œ í•œ ì‚¬ìš©ìê°€ ë™ì‹œì— ì—¬ëŸ¬ ìš”ì²­ì„ ë³´ë‚´ë©´, í‹°ì¼“ì´ ì—¬ëŸ¬ ì¥ ë°œê¸‰ë˜ëŠ” ë¬¸ì œ(ì¼ëª… <strong>â€œë”°ë‹¥â€ ë¬¸ì œ</strong>)ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/71f9a9f0553cb19960e49fc7b02f9fc6/1d574/%EB%94%B0%EB%8B%A5.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 75.88235294117648%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAACPklEQVR42m1TS2/TQBDO70VICAGCA2fuiANcOYPUC7SiTUiT2DhOyYOoSUmT+BUbJ3H8Xq/xY3cZ21HSVszB3tn1N/N9s59rjLEwDHu9nud57E5sY3aisXW8Tyktnpqm9ft9jHG1WavAPM/7vl98VO4SytSI9mymoP0OLdGKooiiGMf7krVq1zRN13X9MmCBEMqSeIUIZfeCEGIYxiHdg5fLJcdxzWYTKHQ6HaHbbdQbrWsJzkAOCsMgCKBiFEXA/ECkhjKKKVvKiue5kK/XazjO85wSctGffjs/r9frrVarUYYgCNDmCOY25MRk36/G3R8cxjEgJUmyHcex7V+rHSpnU7WFRZqmsqqFOcN5Cc5JUUTXDV3Xp9OpLMv6StOlBfZsyQrd7dq3NqPhYDgcQkVR4L+2xU8m61rkqBkaTiYTuIbr8bgp/vxw2X972n5z1uUt3FAsL8koyZMkAc2KqpLiOugRDDOEs/JOyO8geTr/++wmfMzJTwbbR7wioay6RZg2EDxqhhxewKrVbtugczSSb2fYUCNdXltOEnqRZfquA7Jh7KD5Hrh6wZBgzmmeAz8vTgbb4MaL31/03n3+8vEUxt3hOa7DcfP5XFXVh+CCdpYxYC7NZqvN82n4euK9aN++vDJeCZIWpaXtaJZl/+lcgNO0cDAKM4SAbY4RRgi7Tuy7uqaBIhC42+0Wi8VDMPA5OBbyjNCMsjMpkLWVbvyBCUMAHkwChql8egSD3Ssb3A0lYg+8DQ3g/zt0/gdSoDu8dAJAiAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='  ' title='' src='/static/71f9a9f0553cb19960e49fc7b02f9fc6/ca1dc/%EB%94%B0%EB%8B%A5.png' srcset='/static/71f9a9f0553cb19960e49fc7b02f9fc6/e7570/%EB%94%B0%EB%8B%A5.png 170w,\n/static/71f9a9f0553cb19960e49fc7b02f9fc6/f46e7/%EB%94%B0%EB%8B%A5.png 340w,\n/static/71f9a9f0553cb19960e49fc7b02f9fc6/ca1dc/%EB%94%B0%EB%8B%A5.png 680w,\n/static/71f9a9f0553cb19960e49fc7b02f9fc6/02d09/%EB%94%B0%EB%8B%A5.png 1020w,\n/static/71f9a9f0553cb19960e49fc7b02f9fc6/9d567/%EB%94%B0%EB%8B%A5.png 1360w,\n/static/71f9a9f0553cb19960e49fc7b02f9fc6/1d574/%EB%94%B0%EB%8B%A5.png 1510w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>ì´ëŠ” DBì˜ MemberTicket í…Œì´ë¸”ì— <strong>(memberId, stageId) Unique ì œì•½ì¡°ê±´</strong>ì„ ê±¸ì–´ì¤Œìœ¼ë¡œì¨ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<p>í•˜ì§€ë§Œ Unique ì œì•½ ì¡°ê±´ì€ Change Buffer ê¸°ëŠ¥ì„ ë¹„í™œì„±í™” ì‹œí‚´ìœ¼ë¡œ ë°ì´í„° ì‚½ì… ì—°ì‚°ì˜ ì„±ëŠ¥ì´ ì €í•˜ë˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•©ë‹ˆë‹¤.</p>\n<p>ë˜í•œ, í•œ ì‚¬ìš©ìë‹¹ ë°œê¸‰ ê°€ëŠ¥ íšŸìˆ˜ê°€ 1íšŒì—ì„œ 2íšŒë¡œ ë³€ê²½ë  ê²½ìš° í•´ë‹¹ ë°©ë²•ìœ¼ë¡œ í•´ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>\n<p>ì´ëŸ¬í•œ ë”°ë‹¥ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ í•´ê²°ì±…ìœ¼ë¡œë„ Redisë¥¼ í™œìš©í•˜ì˜€ìŠµë‹ˆë‹¤.</p>\n<h3>6-1. ë”°ë‹¥ ë¬¸ì œ í•´ê²°í•˜ê¸°</h3>\n<p>í‹°ì¼“ ì˜ˆë§¤ ì‹œë„ì‹œ, í•´ë‹¹ memberIdì™€ stageIdì˜ ë³µí•©í‚¤ <code class=\"language-text\">trialCount_stageId_memberId</code> ì˜ ê°’ì„ incrementAndGet í•©ë‹ˆë‹¤.</p>\n<p>í•´ë‹¹ ì—°ì‚°ì˜ ë°˜í™˜ê°’ì´, ë°œê¸‰ ê°€ëŠ¥ ë§¤ìˆ˜ë³´ë‹¤ í¬ë©´ ì˜ˆì™¸ì²˜ë¦¬í•©ë‹ˆë‹¤.</p>\n<p>í•´ë‹¹ ì—°ì‚°ì€ í‹°ì¼“ ë°œê¸‰ ê°€ëŠ¥ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ëŠ” ì—°ì‚°ê³¼ <strong>ì›ìì ì¸ ë‹¨ìœ„</strong>ë¡œ ë¬¶ì—¬ìˆê¸° ë•Œë¬¸ì—, ë™ì‹œ ì˜ˆë§¤ì˜ ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>\n<p>ì•„ë˜ëŠ” í•´ë‹¹ ì—°ì‚°ì˜ ìŠ¤í¬ë¦½íŠ¸ì…ë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"lua\"><pre class=\"language-lua\"><code class=\"language-lua\"><span class=\"token keyword\">local</span> memberTryCount <span class=\"token operator\">=</span> redis<span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"INCR\"</span><span class=\"token punctuation\">,</span> KEYS<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\nredis<span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"EXPIRE\"</span><span class=\"token punctuation\">,</span> KEYS<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">-- ë”°ë‹¥ì¸ ê²½ìš°</span>\n<span class=\"token keyword\">if</span> memberTryCount <span class=\"token operator\">></span> <span class=\"token function\">tonumber</span><span class=\"token punctuation\">(</span>ARGV<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">then</span>\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">-</span><span class=\"token number\">2</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">local</span> remainAmount <span class=\"token operator\">=</span> redis<span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"DECR\"</span><span class=\"token punctuation\">,</span> KEYS<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">-- í’ˆì ˆì¸ ê²½ìš°</span>\n<span class=\"token keyword\">if</span> remainAmount <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span>\n<span class=\"token keyword\">then</span>\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">return</span> remainAmount</code></pre></div>\n<p>ì•„ë˜ëŠ” lua ìŠ¤í¬ë¦½íŠ¸ë¥¼ í™œìš©í•œ ì„œë¹„ìŠ¤ ì½”ë“œì…ë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token class-name\">Optional</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getSequence</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Ticket</span> ticket<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Member</span> member<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Long</span> remainAmount <span class=\"token operator\">=</span> redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span>\n        redisScript<span class=\"token punctuation\">,</span>\n        <span class=\"token class-name\">List</span><span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span><span class=\"token function\">makeMemberKey</span><span class=\"token punctuation\">(</span>ticket<span class=\"token punctuation\">,</span> member<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">makeTicketAmountKey</span><span class=\"token punctuation\">(</span>ticket<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token constant\">MAX_MEMBER_TRIAL_COUNT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>remainAmount <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> remainAmount <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">Optional</span><span class=\"token punctuation\">.</span><span class=\"token function\">empty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token class-name\">Integer</span> totalAmount <span class=\"token operator\">=</span> ticket<span class=\"token punctuation\">.</span><span class=\"token function\">getTicketAmount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTotalAmount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">Optional</span><span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span>totalAmount <span class=\"token operator\">-</span> remainAmount<span class=\"token punctuation\">.</span><span class=\"token function\">intValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> <span class=\"token function\">makeMemberKey</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Ticket</span> ticket<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Member</span> member<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Long</span> stageId <span class=\"token operator\">=</span> ticket<span class=\"token punctuation\">.</span><span class=\"token function\">getStage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">Long</span> memberId <span class=\"token operator\">=</span> member<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"trialCount_%d_%d\"</span><span class=\"token punctuation\">,</span> stageId<span class=\"token punctuation\">,</span> memberId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> <span class=\"token function\">makeTicketAmountKey</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Ticket</span> ticket<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ticketAmount_%d\"</span><span class=\"token punctuation\">,</span> ticket<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<hr>\n<h2><strong>ì ìš© ì½”ë“œ ë§í¬</strong></h2>\n<p><a href=\"https://github.com/woowacourse-teams/2023-festa-go/pull/428\">https://github.com/woowacourse-teams/2023-festa-go/pull/428</a></p>","frontmatter":{"title":"ì„ ì°©ìˆœ í‹°ì¼“íŒ…ì— Redis ë„ì…í•˜ê¸°","date":"September 10, 2023","update":"September 10, 2023","tags":["Redis"],"series":null},"fields":{"slug":"/concurrency-redis/","readingTime":{"minutes":8.645}}},"seriesList":{"edges":[{"node":{"id":"9ecb7f42-84ec-536a-9bfc-a3affcb87512","fields":{"slug":"/oauth2-select-and-apply/"},"frontmatter":{"title":"í˜ìŠ¤íƒ€ê³ ì˜ ì¸ì¦ - OAuth2ë¥¼ ì„ íƒí•˜ê³  ì ìš©í•œ ë°©ë²•"}}},{"node":{"id":"1c28c731-cebd-5aab-b9bd-a5c397bf9c7a","fields":{"slug":"/oauth2-multiple-user-auth/"},"frontmatter":{"title":"í˜ìŠ¤íƒ€ê³ ì˜ ì¸ì¦ - ì—¬ëŸ¬ ì‚¬ìš©ìì˜ ì¸ì¦ê³¼ ì¸ê°€"}}},{"node":{"id":"b2e904f3-69c7-5c99-96e7-9555aaddc0e2","fields":{"slug":"/concurrency-redis/"},"frontmatter":{"title":"ì„ ì°©ìˆœ í‹°ì¼“íŒ…ì— Redis ë„ì…í•˜ê¸°"}}},{"node":{"id":"337eca9e-cd03-5e90-9d8f-d0b86e0ce4b9","fields":{"slug":"/facade-service/"},"frontmatter":{"title":"Facade ê°ì²´ë¥¼ í™œìš©í•´ íŠ¸ëœì­ì…˜ì—ì„œ ì™¸ë¶€ API í†µì‹  ë¶„ë¦¬í•˜ê¸°"}}},{"node":{"id":"9ef33612-c159-552c-ba72-40903662c51c","fields":{"slug":"/event-singlelivedata/"},"frontmatter":{"title":"LiveDataë¡œ ì´ë²¤íŠ¸ ì²˜ë¦¬í•˜ê¸°: SingleLiveData"}}}]},"previous":{"fields":{"slug":"/oauth2-multiple-user-auth/"},"frontmatter":{"title":"í˜ìŠ¤íƒ€ê³ ì˜ ì¸ì¦ - ì—¬ëŸ¬ ì‚¬ìš©ìì˜ ì¸ì¦ê³¼ ì¸ê°€"}},"next":{"fields":{"slug":"/facade-service/"},"frontmatter":{"title":"Facade ê°ì²´ë¥¼ í™œìš©í•´ íŠ¸ëœì­ì…˜ì—ì„œ ì™¸ë¶€ API í†µì‹  ë¶„ë¦¬í•˜ê¸°"}}},"pageContext":{"id":"b2e904f3-69c7-5c99-96e7-9555aaddc0e2","series":null,"previousPostId":"1c28c731-cebd-5aab-b9bd-a5c397bf9c7a","nextPostId":"337eca9e-cd03-5e90-9d8f-d0b86e0ce4b9"}},"staticQueryHashes":[],"slicesMap":{}}